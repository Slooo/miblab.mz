{"version":3,"sources":["main.js","items.js","orders.js","supply.js","costs.js","discounts.js","settings.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1QA;AACA;AACA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["/*\n\t------- MAIN FUNCTION ------- \n*/\n\n// cashier\nfunction CashierPageLoad()\n{\n\tif(localStorage.getItem('order-table') == null)\n\t{\n\t\t$('.order').addClass('hidden');\n\t\t$('#js-item--search').val('').focus();\n\t} else {\n\t\t// запрос на скидки\n\t\tOrderTotalSum();\n\t\tOrderButtonActive($('.js-order--type').eq(localStorage['order-type-index']));\n\t\tOrderButtonActive($('.js-order--discount').eq(localStorage['order-discount-index']));\n\t\t$('.order-table').removeClass('hidden').html(localStorage.getItem('order-table'));\n\t}\n}\n\n// clear order\nfunction OrderClear()\n{\n\tlocalStorage.clear();\n\t$('.order-table table tbody').html('');\n\t$('.js-order--type').removeClass('active');\n\tCashierPageLoad();\n}\n\n// push item\nfunction OrderItemAdd(data)\n{\n\tvar json, items;\n\tif(localStorage.getItem('items') == null)\n\t{\n\t\tjson = {};\n\t\titems = [];\n\t\tjson.items = items;\n\t\tjson.items.push(data);\n\t\tjson.totalSum = data.price * data.quantity;\n\t\tjson.discount = false;\n\t\tlocalStorage.setItem('items', JSON.stringify(json));\n\t} else {\n\t\tjson = JSON.parse(localStorage.getItem('items'));\n\t\tjson.items.push(data);\n\t\tlocalStorage.setItem('items', JSON.stringify(json));\n\t}\n\n\tOrderTotalSum();\n}\n\n// update order\nfunction OrderUpdate(here)\n{\n\tvar parents, item, placeholder, price, quantity, sum;\n\n\tparents \t= here.parents('tr');\n\titem \t \t= parents.data('item');\n\tplaceholder = here.attr('placeholder');\n\tvalue \t\t= Number(here.val());\n\n\t// return before value\n\tif(value.length == 0)\n\t{\n\t\tif(placeholder.length > 0)\n\t\t{\n\t\t\there.val(placeholder);\n\t\t} else {\n\t\t\there.val(1);\n\t\t}\n\t}\n\n\t// if 0 return 1\n\tif(value == 0)\n\t{\n\t\there.val(1);\n\t}\n\n\t// if here = price\n\tif(here.parent('td').hasClass('js-order--update-price'))\n\t{\n\t\tprice = value;\n\t\tquantity = Number(parents.find('.js-order--update-quantity').text());\n\t}\n\n\t// if here = quantity\n\tif(here.parent('td').hasClass('js-order--update-quantity'))\n\t{\n\t\tprice = Number(parents.find('.js-order--update-price').text());\n\t\tquantity = value;\n\t}\n\n\t// update item\n\tOrderItemUpdate(here, item, price, quantity);\n}\n\n// order total sum\nfunction OrderTotalSum()\n{\n\tjson = JSON.parse(localStorage.getItem('items'));\n\ttotalSum = json.items.reduce(function(sum, current) {\n\t\treturn sum + current.sum;\n\t}, 0);\n\n\tjson.totalSum = totalSum;\n\tlocalStorage.setItem('items', JSON.stringify(json));\n\t$('#order-sum').html(totalSum);\n}\n\n// update item\nfunction OrderItemUpdate(here, item, price, quantity)\n{\n\tvar json, sum, product;\n\n\tjson = JSON.parse(localStorage.getItem('items'));\n\n\t// qty in stock\n\tmax_qty = json.items[item].stock;\n\n\t// check quantity update with max qty in stock\n\tqty = (quantity <= max_qty ? quantity : max_qty);\n\n\tsum = price * qty;\n\n\t// set item\n\tjson.items[item].price = price;\n\tjson.items[item].quantity = qty;\n\tjson.items[item].sum = sum;\n\n\t// save items\n\tlocalStorage.setItem('items', JSON.stringify(json));\n\n\tOrderTotalSum();\n\t\n\t// save item\n\tproduct = $('*[data-item=\"'+item+'\"]');\n\tproduct.find('.js-order--sum').html(sum);\n\n\t// save all\n\tlocalStorage.setItem('order-table', $('.order-table').html());\n\n\t// return value input\n\tif(here && here.parent('td').hasClass('js-order--update-price'))\n\t{\n\t\there.parent('td').html(price);\t\t\n\t}\n\n\tif(here && here.parent('td').hasClass('js-order--update-quantity'))\n\t{\n\t\there.parent('td').html(qty);\t\t\n\t}\n}\n\n// order items paste in html\nfunction OrderItemPaste(json)\n{\n\tvar html, item, id, price, quantity, data;\n\n\titem = $('.order-table tbody tr').length;\n\n\thtml += '<tr data-item=\"'+item+'\" data-id=\"'+json.id+'\">';\n\thtml += '<td>'+json.barcode+'</td>';\n\thtml += '<td>'+json.name+'</td>';\n\thtml += '<td class=\"js-order--update js-order--update-price\">'+json.price+'</td>';\n\thtml += '<td class=\"js-order--update js-order--update-quantity\">1</td>';\n\thtml += '<td class=\"js-order--sum\">'+json.price+'</td>';\n\thtml += '<td><button type=\"button\" class=\"btn btn-xs btn-danger js-order--remove\"><i class=\"fa fa-remove\"></i></button></td>';\n\thtml += '</tr>';\n\n\t// save object in localStorage\n\tdata = {\n\t\tid \t\t : json.id,\n\t\titem\t : item,\n\t\tbarcode  : json.barcode,\n\t\tprice    : Number(json.price),\n\t\tquantity : 1,\n\t\tsum \t : Number(json.price),\n\t\tstock \t : Number(json.stock),\n\t}\n\n\tOrderItemAdd(data);\n\n\t$('.order-table table tbody').append(html);\n\tlocalStorage.setItem('order-table', $('.order-table').html());\n\tCashierPageLoad();\n}\n\n// remove dublicate qty stock\nfunction removeDuplicates(arr, prop) {\n\tvar new_arr = [];\n\tvar lookup  = {};\n\n\tfor (var i in arr) {\n\t\tlookup[arr[i][prop]] = arr[i];\n\t}\n\n\tfor (i in lookup) {\n\t\tnew_arr.push(lookup[i]);\n\t}\n\n\treturn new_arr;\n}\n\n// find element in array to object\nfunction functiontofindIndexByKeyValue(arraytosearch, key, valuetosearch) {\n\tfor (var i = 0; i < arraytosearch.length; i++) {\n \t\tif (arraytosearch[i][key] == valuetosearch) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn 'z';\n}\n\n// active button\nfunction OrderButtonActive(index) \n{\n\tvar btn = index.siblings();\n\n\tbtn.each(function(){\n\t  $(this).removeClass('active');\n\t});\n\n\tindex.addClass('active');\n}\n\n// loader start\nfunction LoaderStart()\n{\n\t//$('#js-modal--create').modal('hide');\n\t$('body').append('<div class=\"loader\"></div>');\t\n}\n\n// loader stop\nfunction LoaderStop()\n{\n\t$('.loader').remove();\n\t//$('#js-modal--create').modal('hide');\n}\n\n// answer success\nfunction AnswerSuccess(answer)\n{\n\t$('#js-modal--create').modal('hide');\n\t$('#alert').removeClass().addClass('alert alert-success').html(answer);\t\t\n}\n\n// answer error\nfunction AnswerError()\n{\n\t$('#js-modal--create').modal('hide');\n\t$('#alert').removeClass().addClass('alert alert-danger').html('Ошибка запроса');\t\n}\n\n// answer info\nfunction AnswerInfo(answer)\n{\n\t$('#js-modal--create').modal('hide');\n\t$('#js-modal--delete').modal('hide');\n\t$('#alert').removeClass().addClass('alert alert-info').html(answer);\t\n}\n\n// answer warning\nfunction AnswerWarning(answer)\n{\n\t$('#js-modal--create').modal('hide');\n\t$('#alert').removeClass().addClass('alert alert-warning').html(answer);\t\n}\n\n// answer removed\nfunction AnswerDanger(answer)\n{\n\t$('#js-modal--create').modal('hide');\n\tqp = segment2.substring(0, segment2.length - 1);\n\t$('#alert').removeClass().addClass('alert alert-danger').html('<button class=\"btn btn-danger\" id=\"js--restore-'+qp+'\">Отменить удаление <i class=\"fa fa-history\"></i></button>');\t\n}\n\n// number format\nfunction number_format( number, decimals, dec_point, thousands_sep ) {\n\n\tvar i, j, kw, kd, km;\n\n\t// input sanitation & defaults\n\tif( isNaN(decimals = Math.abs(decimals)) ){\n\t\tdecimals = 2;\n\t}\n\tif( dec_point == undefined ){\n\t\tdec_point = \",\";\n\t}\n\tif( thousands_sep == undefined ){\n\t\tthousands_sep = \".\";\n\t}\n\n\ti = parseInt(number = (+number || 0).toFixed(decimals)) + \"\";\n\n\tif( (j = i.length) > 3 ){\n\t\tj = j % 3;\n\t} else{\n\t\tj = 0;\n\t}\n\n\tkm = (j ? i.substr(0, j) + thousands_sep : \"\");\n\tkw = i.substr(j).replace(/(\\d{3})(?=\\d)/g, \"$1\" + thousands_sep);\n\t//kd = (decimals ? dec_point + Math.abs(number - i).toFixed(decimals).slice(2) : \"\");\n\tkd = (decimals ? dec_point + Math.abs(number - i).toFixed(decimals).replace(/-/, 0).slice(2) : \"\");\n\n\treturn km + kw + kd;\n}\n\n// don't close\n$('.modal').modal({\n    backdrop: 'static',\n    keyboard: false,\n    show: false,\n});\n\n$(document).ready(function() {\n\n\t// total sum\n\tfunction totalSumAndDiscount(data)\n\t{\n\t\tvar line, totalSum = 0, totalSumDiscount = 0;\n\n\t\tif($('strong').hasClass('totalSum'))\n\t\t{\n\t\t\tif(data)\n\t\t\t{\n\t\t\t\tline = $('.table tbody').find(\"[data-id='\" + data.id + \"']\");\n\t\t\t\t$(line).find('td.js--totalSum').html(number_format(data.sum, 0, ' ', ' '));\t\t\t\n\t\t\t}\n\n\t\t\t$('td.js--totalSum').each(function(){\n\t\t\t\ttotalSum += parseFloat($(this).text().replace(/\\s/g, ''));\n\t\t\t});\n\n\t\t\t$('.totalSum').html('Итого ' + number_format(totalSum, 0, ' ', ' ') + ' &#8381;');\t\n\t\t}\n\n\t\t// пока непонятно как считать скидку при изменениях.\n\t\tif($('strong').hasClass('totalSumDiscount'))\n\t\t{\n\t\t\t$('.js--sum-discount').each(function(){\n\t\t\t    totalSumDiscount += parseFloat($(this).text().replace(/\\s/g, ''));\n\t\t\t});\n\n\t\t\t$('.totalSumDiscount').html('Итого со скидкой ' + number_format(totalSumDiscount, 0, ' ', ' ') + ' &#8381;');\n\t\t}\n\t}\n\n\t// check create\n\tfunction validationCreate(answer)\n\t{\n\t\tvar json, keys, input, data;\n\t\tjson = JSON.parse(answer.responseText);\n\n\t\tswitch(answer.status)\n\t\t{\n\t\t\t// error validation\n\t\t\tcase 422:\n\t\t\t\tkeys = Object.keys(json);\n\n\t\t\t\t$(\"form input\").each(function(){\n\t\t\t\t\tinput = $(this);\n\t\t\t\t\tif(keys.indexOf(input.attr('name')) != -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tinput.addClass('validate-error');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinput.addClass('validate-success');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tbreak;\n\n\t\t\t// success\n\t\t\tcase 200:\n\t\t\t\tswitch(segment2)\n\t\t\t\t{\n\t\t\t\t\tcase 'items':\n\t\t\t\t\t\tjson.data.price  = number_format(json.data.price, 0, ' ', ' ');\n\n\t\t\t\t\t\thtml =  '<tr data-id=\"'+json.data.id+'\">'; \n\t\t\t\t\t\thtml += '<td>'+json.data.barcode+'</td>';\n\t\t\t\t\t\thtml += '<td>'+json.data.name+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"js--update\" data-column=\"price\">'+json.data.price+'</td>';\n\t\t\t\t\t\thtml += '<td><button class=\"btn btn-circle btn-success js-items--status\" data-status=\"'+json.data.status+'\"><i class=\"fa fa-check\"></i></button></td>';\n\t\t\t\t\t\thtml += '<td><button type=\"button\" data-barcode=\"'+json.data.barcode+'\" class=\"btn btn-circle btn-primary js-items--print-review\"><i class=\"fa fa-print\"></i></button></td>';\n\t\t\t\t\t\thtml += '</tr>';\n\n\t\t\t\t\t\t$('.table tbody').prepend(html);\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'costs':\n\t\t\t\t\t\tdata = json.data;\n\t\t\t\t\t\tdata.date = moment(json.data.created_at, \"YYYY-MM-DD HH:mm:ss\").format('DD/MM/YYYY');\n\t\t\t\t\t\tdata.sum  = number_format(json.data.sum, 0, ' ', ' ');\n\n\t\t\t\t\t\thtml =  '<tr data-id=\"'+data.id+'\">';\n\t\t\t\t\t\thtml += '<td class=\"col-md-1\">'+data.id+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-1\">'+data.date+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-9 js--totalSum js--update\" data-column=\"sum\">'+data.sum+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-1\"><button class=\"btn btn-circle btn-danger js--delete\"><li class=\"fa fa-remove\"></li></button></td>';\n\t\t\t\t\t\thtml += '</tr>';\n\n\t\t\t\t\t\t$('.table tbody').prepend(html);\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'discounts':\n\t\t\t\t\t\tjson.data.sum  = number_format(json.data.sum, 0, ' ', ' ');\n\n\t\t\t\t\t\thtml = '<tr data-id=\"'+json.data.id+'\">';\n\t\t\t\t\t\thtml += '<td class=\"col-md-1\">'+json.data.id+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-5 js--update\" data-column=\"sum\">'+json.data.sum+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-5 js--update\" data-column=\"percent\">'+json.data.percent+'</td>';\n\t\t\t\t\t\thtml += '<td class=\"col-md-1\"><button class=\"btn btn-danger btn-circle js--delete\"><i class=\"fa fa-remove\"></i></button></td>';\n\t\t\t\t\t\thtml += '</tr>';\n\n\t\t\t\t\t\t$('.table tbody').prepend(html);\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t$('.table tbody tr').removeClass().first().addClass('success');\n\t\t\t\t}\n\n\t\t\t\tAnswerInfo(json.message);\n\t\t\t\ttotalSumAndDiscount();\n\t    \tbreak;\n\n\t\t\tdefault:\n\t\t\t\tAnswerError();\n\t\t\tbreak;\n\t\t}\n\n\t\tLoaderStop();\n\t}\n\n\t// check update\n\tfunction validationUpdate(answer, here)\n\t{\n\t\tvar json = JSON.parse(answer.responseText);\n\n\t\tswitch(answer.status)\n\t\t{\n\t\t\t// error validation\n\t\t\tcase 422:\n\t\t\t\there.parent('td').html(here.attr('placeholder'));\n\n\t\t\t\t//!\n\t\t\t\t$('.table tbody tr').removeClass();\n\t\t\t\there.parents('tr').addClass('warning');\n\n\t\t\t\tAnswerWarning(json.message.value);\n\t\t\tbreak;\n\n\t\t\t// success\n\t\t\tcase 200:\n\t\t\t\t/* проверять какой столбец и к какому типу он относится\n\t\t\t\t\tval = here.parent('td').data('column') == 'int' ? number_format(here.val(), 0, ' ', ' ' : here.val()\n\t\t\t\t*/\n\t\t\t\tval = number_format(here.val(), 0, ' ', ' ');\n\t\t\t\there.parent('td').html(val);\n\t\t\t\t$('.table tbody tr').removeClass();\n\t\t\t\there.parents('tr').addClass('info');\n\t\t\t\ttotalSumAndDiscount(json.data);\n\n\t\t\t\tAnswerInfo(json.message);\n\t\t\tbreak;\n\t\t}\n\n\t\tLoaderStop();\n\t}\n\n\t// check delete\n\tfunction validationDelete(answer, line)\n\t{\n\t\tvar json = JSON.parse(answer.responseText);\n\n\t\tswitch(answer.status)\n\t\t{\n\t\t\t// error validation\n\t\t\tcase 422:\n\t\t\t\tAnswerError();\n\t\t\tbreak;\n\n\t\t\t// redirect\n\t\t\tcase 301:\n\t\t\t\twindow.location.href = base_url +'/'+ segment1 +'/'+ segment2;\t\n\t\t\tbreak;\n\n\t\t\t// success\n\t\t\tcase 200:\n\t\t\t\t//AnswerDanger(json.data.id);\n\t\t\t\tAnswerInfo(json.message);\n\t\t\t\tline.remove();\n\t\t\t\ttotalSumAndDiscount();\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tAnswerError();\n\t\t\tbreak;\n\t\t}\n\n\t\tLoaderStop();\n\t}\n\n\t// datepicker\n\t$(function () {\n\t\t$('#datetimepicker, #datetimepicker2').datetimepicker(\n\t\t\t{locale: 'ru', format: 'DD/MM/YYYY'}\n\t\t);\n\t});\n\n\t// DATE RANGE\n\t$('#js-settings--date-range').click(function(e){\n\t\te.preventDefault();\n\n\t\tvar dateStart, dateEnd, data, url, segments, html, json;\n\n\t\tdateStart = $('#date_start').val();\n\t\tdateEnd   = $('#date_end').val();\n\t\tdata \t  = {'dateStart' : dateStart, 'dateEnd' : dateEnd, 'id' : segment3};\n\n\t\t$.ajax({\n\t\t\turl \t : base_url + '/' + segment1 + '/' + segment2 + '/' + 'date',\n\t\t\ttype \t : \"patch\",\n\t\t\tdataType : \"json\",\n\t\t\tdata \t : data,\n\n\t\t\tbeforeSend: function(){\n\t\t\t\t$('.dropdown').removeClass('open');\n\t\t        LoaderStart();\n\t\t    },\n\n\t\t\tsuccess: function(answer) {\n\n\t\t\t\t$('.col-body h2').remove();\n\n\t\t\t\tif(answer.status == 0)\n\t\t\t\t{\n\t\t\t\t\t$('.table').addClass('hidden');\n\t\t\t\t\t$('.col-footer').addClass('hidden');\n\t\t\t\t\t$('.col-body').append('<h2>'+answer.data+'</h2>');\n\t\t\t\t}\n\n\t\t\t\tif(answer.status == 1)\n\t\t\t\t{\n\t\t\t\t\thtml = \"\";\n\t\t\t\t\tjson = JSON.stringify(answer.data);\n\t\t\t\t\tdata = JSON.parse(json);\n\t\t\t\t\t\n\t\t\t\t\t$('.table').removeClass('hidden');\n\t\t\t\t\t$('.col-footer').removeClass('hidden');\n\n\t\t\t\t\tif(segment2 != 'costs/')\n\t\t\t\t\t{\n\t\t\t\t\t\tfor(row in data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml += '<tr data-id=\"'+data[row].id+'\" data-type=\"main\">';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-2 js-url--link\" data-url=\"'+base_url + segment1 + segment2 + data[row].id+'\">'+data[row].id+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-1\">'+data[row].date+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-3\">'+data[row].sum+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-3\">'+data[row].sum_discount+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-2\">'+data[row].type+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-1\"><button class=\"btn btn-circle btn-danger js--delete\"><li class=\"fa fa-remove\"></li></button></td>';\n\t\t\t\t\t\t\thtml += '</tr>';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor(row in data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml += '<tr data-id=\"'+data[row].id+'\" data-type=\"pivot\">';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-1\">'+data[row].date+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-10\">'+data[row].sum+'</td>';\n\t\t\t\t\t\t\thtml += '<td class=\"col-md-1\"><button class=\"js--delete btn btn-circle btn-danger\"><li class=\"fa fa-remove\"></li></button></td>';\n\t\t\t\t\t\t\thtml += '</tr>';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$('.table tbody').html(html);\n\t\t\t\t\t$('.totalSum').html('Итого: ' + answer.extra.totalSum + ' &#8381;');\n\t\t\t\t}\n\t\t    },\n\n\t\t    error: function(answer) {\n\t\t    \tAnswerError();\n\t\t    }\n\n\t\t}).complete(function() {\n\t\t    LoaderStop();\n\t\t});\n\t});\n\n\t// link url\n\t$('body').on('click', '.js-url--link', function(e){\n\t\te.preventDefault();\n\t\tvar url = $(this).data('url');\n\t    window.location = url;\n\t});\n\n\t// ---------- CREATE ----------\n\n\t$('#js-modal--create').on('show.bs.modal', function(){\n\t\t$('input').first().focus();\n\t});\n\n\t$('#js-modal--create').on('hidden.bs.modal', function(){\n\t\t$('input').val('');\n\t\t$('input[name=points_id]').val(points_id);\n\t});\n\n\t// ---------- UPDATE ----------\n\n\t// update focusout\n\t$('body').on('focusout', '#js--update', function(){\n\t\tupdate($(this));\n\t});\n\n\t// update press enter\n\t$('body').on('keypress', '#js--update', function(e){\n\t\tif(e.which == 13) {\n\t\t\tupdate($(this));\n\t\t}\n\t});\n\n\t// select update item order\n\t$('body').on('click', '.js--update', function(){\n\t\tvar here, data;\n\t\t\n\t\there = $(this);\n\t\tdata = here.text();\n\n\t\there.html('<input type=\"number\" id=\"js--update\" placeholder=\"'+data+'\">');\n\t\there.find('input').focus();\n\t});\n\n\t// update\n\tfunction update(here){\n\t\tvar here, id, line, column, data, json;\n\n\t\tif(here.val() == 0 || here.val().length == 0)\n\t\t{\n\t\t\there.parent('td').html(here.attr('placeholder'));\n\t\t} else {\n\n\t\t\tline   = here.parents('tr');\n\t\t\tid \t   = line.data('id');\n\t\t\tcolumn = here.parent('td').data('column');\n\t\t\ttype   = line.parents('tbody').data('type');\n\t\t\tdata   = {\"column\":column, \"value\":here.val(), \"type\":type};\n\n\t\t\t$.ajax({\n\t\t\t\turl \t : base_url + '/' + segment1 + '/' + segment2 + '/' + id,\n\t\t\t\ttype \t : 'patch',\n\t\t\t\tdataType : 'json',\n\t\t\t\tdata \t : data,\n\n\t\t\t\tbeforeSend: function(){\n\t\t\t        LoaderStart();\n\t\t\t    },\n\n\t\t\t    complete: function(answer, xhr, settings){\n\t\t\t\t    validationUpdate(answer, here);\n\t\t\t    }\n\n\t\t\t});\n\t\t}\n\t}\n\n\t// ---------- DELETE ----------\n\n\t$('body').on('click', '.js--delete', function(e){\n\t\te.preventDefault();\n\n\t\t$(this).attr('id', 'active');\n\t\t$('#js-modal--delete').modal('show');\n\t});\n\n\t$('body').on('click', '#js--delete', function(e){\n\t\te.preventDefault();\n\n\t\tvar data, line, id;\n\n\t\tline = $('#active').parents('tr');\n\t\tid = line.data('id');\n\n\t\t$.ajax({\n\t\t\turl \t : base_url + '/' + segment1 + '/' + segment2 + '/' + 'delete' + '/' + id,\n\t\t\ttype \t : 'post',\n\t\t\tdataType : 'json',\n\t\t\tdata \t : {\"type\":$('#active').parents('tbody').data('type')},\n\n\t\t\tbeforeSend: function(){\n\t\t        LoaderStart();\n\t\t    },\n\n\t\t    complete: function(answer, xhr, settings){\n\t\t    \tvalidationDelete(answer, line);\n\t\t    }\n\n\t\t});\n\t});\n\n\t$(\"#js-modal--delete\").on(\"hidden.bs.modal\", function (){ \n\t    $('.js--delete').removeAttr('id');\n\t});","/*\n\t------- ITEMS FUNCTION ------- \n*/\n\n// create & update item\n$('body').on('click', '#js-items--create', function(e){\n\te.preventDefault();\n\n\tvar data, id, url, type, json, html;\n\t\n\tdata = $('#js-items--form').serialize();\n\tid \t = $('#items_id').val();\n\n\tif(id == 0)\n\t{\n\t\t//create\n\t\turl = base_url + '/' + segment1 + '/' + segment2;\n\t\ttype = \"post\";\n\n\t} else {\n\t\t//update\n\t\turl = id;\n\t\ttype = \"patch\";\n\t}\n\n\t$.ajax({\n\t\turl \t : url,\n\t\ttype \t : type,\n\t\tdataType : \"json\",\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t    complete: function(answer, xhr, settings){\n\t    \tvalidationCreate(answer);\n\t    }\n\n\t});\n\n});\n\n// update status\n$('body').on('click', '.js-items--status', function(e){\n\te.preventDefault();\n\n\tvar btn, status, id, data;\n\n\tbtn    = $(this);\n\tstatus = btn.attr('data-status');\n\tid \t   = btn.parents('tr').data('id');\n\tdata   = {'id':id, 'status':status}\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + segment2 + '/' + 'status',\n\t\ttype \t : \"patch\",\n\t\tdataType : \"json\",\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t\tsuccess: function(answer) {\n\t\t\tif(answer.status == 0)\n\t\t\t{\n\t\t\t\tbtn.removeClass('btn-success').addClass('btn-danger');\n\t\t\t\tbtn.html('<i class=\"fa fa-ban\"></i>');\n\t\t\t\tbtn.attr('data-status', answer.status);\n\t\t\t}\n\n\t\t\tif(answer.status == 1)\n\t\t\t{\n\t\t\t\tbtn.removeClass('btn-danger').addClass('btn-success');\n\t\t\t\tbtn.html('<i class=\"fa fa-check\"></i>');\n\t\t\t\tbtn.attr('data-status', answer.status);\n\t\t\t}\n\t    },\n\n\t    error: function(answer) {\n\t    \tAnswerError();\n\t    }\n\n\t}).complete(function() {\n\t    LoaderStop();\n\t});\n});\n\n// search item\n$('#js-item--barcode').focusout(function() {\n\n\tvar barcode, data, json, item;\n\n\tbarcode = $(this).val();\n\tdata = {'barcode':barcode}\n\n\tif(barcode)\n\t{\n\t\t$.ajax({\n\t\t\turl:     base_url + '/' + segment1 + '/' + segment2 + '/' + 'search',\n\t\t\ttype:     \"patch\",\n\t\t\tdataType: \"json\",\n\t\t\tdata: data,\n\n\t\t\tbeforeSend: function(){\n\t        \tLoaderStart();\n\t\t    },\n\n\t\t\tsuccess: function(answer) {\n\t\t\t\tif(answer.status == 0)\n\t\t\t\t{\n\t\t\t\t\t$('#item_id, #name, #price, #quantity').val('');\n\t\t\t\t\t$('#js-item--sbm').text('Создать');\n\t\t\t\t\tAnswerInfo('<strong>'+answer.message+'</strong>. Будет создан новый');\n\t\t\t\t}\n\n\t\t\t\tif(answer.status == 1)\n\t\t\t\t{\n\t\t\t\t\titem = JSON.parse(JSON.stringify(answer.items));\n\n\t\t\t\t\t$('#item_id').val(item.id);\n\t\t\t\t\t$('#name').val(item.name);\n\t\t\t\t\t$('#price').val(item.price);\n\t\t\t\t\t$('#quantity').val(item.quantity);\n\t\t\t\t\t$('#js-item--sbm').text('Обновить');\n\t\t\t\t\tAnswerWarning('<strong>'+answer.message+'</strong>. Будет обновлен');\n\t\t\t\t}\n\t\t    },\n\n\t\t    error: function(answer) {\n\t\t    \tAnswerError();\n\t\t    }\n\n\t\t}).complete(function() {\n\t        LoaderStop();\n\t\t});\n\t}\n});\n\n/* --- PRINT BARCODE --- */\n\n// select barcode\n$('body').on('click', '.js-items--print-review', function(e){\n\te.preventDefault();\n\tvar barcode = $(this).data('barcode');\n\t$('#print-modal strong').html(barcode);\n\t$('#js-items--print-review').val(barcode);\n\t$('#print-modal').modal('show');\n});\n\n// open modal barcode review\n$('#print-modal').on('shown.bs.modal', function () {\n    $('#print-quantity').numeric({decimal: false, negative: false}).focus();\n});\n\n// if qty = 0 return 1 вставить везде\n$('#print-quantity').keyup(function(){\n\tif($(this).val() == '0'){\n\t\t$(this).val(1);\n\t}\n});\n\n// close modal & clear review\n$('#js-items--print-cancel').click(function(e){\n\t$('.full').addClass('hidden');\n\t$('.row').removeClass('hidden');\n\t$('#print-modal').modal('hide');\n});\n\n// generate barcode\n$('#js-items--print-review').click(function(e){\n\n\t$('#print-modal').modal('hide');\n\t$('.row').addClass('hidden');\n\n\tvar html, barcode, quantity, data, json, item;\n\n\thtml \t = \"\";\n\tbarcode  = $('#js-items--print-review').val();\n\tquantity = $('#print-quantity').val();\n\tdata \t = {'barcode':barcode};\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + segment2 + '/' + 'barcode/generate',\n\t\ttype \t : 'patch',\n\t\tdataType : 'json',\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t\tsuccess: function(answer) {\n\t\t\tif(answer.status == 200)\n\t\t\t{\n\t\t\t\tjson = JSON.stringify(answer.item);\n\t\t\t\titem = JSON.parse(json);\n\t\t\t\tfor (i = 0; i < quantity; i++) {\n\t\t\t\t\thtml += '<div class=\"box\">';\n\t\t\t\t\thtml += '<div class=\"header\">ИП Зибарева С.С.</div>';\n\t\t\t\t\thtml += '<div class=\"description\"><span>'+item.barcode+'</span><time>'+answer.time+'</time></div>';\n\t\t\t\t\thtml += '<div class=\"title\">'+item.name+'</div>';\n\t\t\t\t\thtml += '<div class=\"barcode\">'+answer.barcode+'<br>';\n\t\t\t\t\thtml += '<span>'+item.barcode+'</span></div>';\n\t\t\t\t\thtml += '<div class=\"footer\"><p>'+item.price+'</p>';\n\t\t\t\t\thtml += '<span>руб. за шт.</span>';\n\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t}\n\n\t\t\t\t$('.full').removeClass('hidden');\n\t\t\t\t$('.print').html(html);\n\t\t\t}\n\t    },\n\n\t    error: function(answer) {\n\t    \tAnswerError();\n\t\t}\n\n\t}).complete(function() {\n\t        LoaderStop();\n\t\t});\n});\n\n// print\n$('body').on('click', '#js--items-print', function(e){\n\te.preventDefault();\n\twindow.print();\n});\n\n/* --- END PRINT BARCODE --- */","/*\n\t------- ORDERS FUNCTION ------- \n*/\n\n// create order and supply\n$('body').on('click', '#js-orders-and-supply--create', function(e){\n\te.preventDefault();\n\n\tvar json, sum, sumDiscount, type, discount, counterparty, items, data;\n\n\tjson  = JSON.parse(localStorage.getItem('items'));\n\ttotalSum = json.totalSum;\n\ttype  = json.type;\n\tdiscount = json.discount;\n\tcounterparty = json.counterparty;\n\titems = JSON.stringify(json.items);\n\tdata  = {'totalSum' : totalSum, 'type' : type, 'discount': discount, 'counterparty' : counterparty, 'items' : items};\n\t\n\turl = (url != 'supply' ? 'orders' : 'supply');\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + url,\n\t\ttype \t : 'post',\n\t\tdataType : 'json',\n\t\tdata  \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t\tsuccess: function(answer) {\n\t\t\tif(answer.status == 1)\n\t\t\t{\n\t\t\t\tOrderClear();\n\t\t\t\tAnswerSuccess('<a href=\"'+base_url + '/' + segment1 + '/' + url + '/' + answer.message +'\">Создано</a>');\n\t\t\t}\n\t    },\n\n\t    error: function(answer) {\n\t    \tAnswerError();\n\t\t}\n\n\t}).complete(function() {\n\t        LoaderStop();\n\t\t});\n});\n\n// type order\n$('body').on('click', '.js-order--type', function(e){\n\t\n\tvar btn, type, json;\n\n\tbtn  = $(this);\n\ttype = btn.val();\n\n\tif(localStorage){\n\t\tlocalStorage['order-type-index'] = btn.index();\n\t}\n\n\tjson = JSON.parse(localStorage.getItem('items'));\n\tjson.type = type;\n\tlocalStorage.setItem('items', JSON.stringify(json));\n\tOrderButtonActive(btn);\n});\n\n// discount order\n$('body').on('click', '.js-order--discount', function(e){\n\t\n\tvar btn, json;\n\n\tbtn = $(this);\n\n\tif(localStorage){\n\t\tlocalStorage['order-discount-index'] = btn.index();\n\t}\n\n\tjson = JSON.parse(localStorage.getItem('items'));\n\n\tif($(this).hasClass('active'))\n\t{\n\t\t$(this).removeClass('active');\n\t\tjson.discount = false;\n\t} else {\n\t\t$(this).addClass('active');\n\t\tjson.discount = true;\n\t}\n\n\tlocalStorage.setItem('items', JSON.stringify(json));\n});\n\n// counterparty\n$('body').on('change', '.js-supply--counterparty', function(e){\n\n\tvar here, json;\n\n\there = Number($(\"option:selected\", this).val());\n\tjson = JSON.parse(localStorage.getItem('items'));\n\tjson.counterparty = here;\n\tlocalStorage.setItem('items', JSON.stringify(json));\n});\n\nvar timer;\n   $('#some_id').keyup(function () {\n       window.clearTimeout(timer);\n       if ($('#some_id').val().length > 2) {\n           timer = setTimeout(function () {\n               // тут ajax запрос\n           }, 1000);\n       }\n   });\n\n\n// search item\n$('#js-items--search').keyup(function(e){\n\te.preventDefault();\n\n\tvar barcode, items, data, json, quantity, unique;\n\n\twindow.clearTimeout(timer);\n\n\tbarcode = $(this).val();\n\n\titems = localStorage.getItem('items');\n\tdata = {'barcode':barcode, 'items':items};\n\n\tif(barcode.length > 10)\n\t{\n\t\tsetTimeout(function(){ \n\t\t\t$.ajax({\n\t\t\t\turl \t : base_url + '/' + segment1 + '/' + 'items/search',\n\t\t\t\ttype \t : 'patch',\n\t\t\t\tdataType : 'json',\n\t\t\t\tdata \t : data,\n\n\t\t\t\tbeforeSend: function(){\n\t\t\t        LoaderStart();\n\t\t\t    },\n\n\t\t\t\tsuccess: function(answer) {\n\t\t\t\t\tif(answer.status == 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tAnswerWarning('<button id=\"js-item--barcode-create\" class=\"btn btn-danger\">Отправить штрихкод</button>');\n\t\t\t\t\t}\n\n\t\t\t\t\tif(answer.status == 1)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.order').removeClass('hidden');\n\t\t\t\t\t\t$('#alert').removeClass().html('');\n\n\t\t\t\t\t\tjson = JSON.parse(JSON.stringify(answer.data));\n\t\t\t\t\t\tOrderItemPaste(json);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(answer.status == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tAnswerWarning(answer.message);\n\t\t\t\t\t\t$('table tr').removeClass('info');\n\t\t\t\t\t\tvar parents = $('*[data-item=\"'+answer.data+'\"]').addClass('info');\n\t\t\t\t\t\tparents.find('.js-order--update-quantity').html(quantity);\n\t\t\t\t\t}\n\t\t\t    },\n\n\t\t\t    error: function(answer) {\n\t\t\t    \tAnswerError();\n\t\t\t    }\n\n\t\t\t}).complete(function() {\n\t\t\t\t\tLoaderStop();\n\t\t\t\t});\n\t\t}, 2000);\n\t}\n});\n\n// select update item order\n$('body').on('click', '.js-order--update', function(){\n\tvar here, data;\n\t\n\there = $(this);\n\tdata = here.text();\n\n\there.html('<input type=\"number\" id=\"js-order--update\" placeholder=\"'+data+'\">');\n\there.find('input').focus();\n});\n\n// update item press enter\n$('body').on('keypress', '#js-order--update', function(e){\n\tif(e.which == 13) {\n\t\tOrderUpdate($(this));\n\t}\n});\n\n// update item focusout\n$('body').on('focusout', '#js-order--update', function(){\n\tOrderUpdate($(this));\n});\n\n// delete item order\n$('body').on(\"click\", \".js-order--remove\", function(){\n\n\tvar parents, item, price, quantity, count, json, index;\n\n\tparents  = $(this).parents('tr');\n\titem  \t = parents.data('item');\n\tprice \t = parents.find('.js-order--price').val();\n\tquantity = parents.find('.js-order--quantity').val();\n\tcount \t = $('.order-table tbody tr').length;\n\tjson \t = JSON.parse(localStorage.getItem('items'));\n\n\tindex = json.items.findIndex(function(array, i){\n\t   \treturn array.item === item\n\t});\n\n\tjson.items.splice(index, 1);\n\tlocalStorage.setItem('items', JSON.stringify(json));\n\n\tparents.remove();\n\n\tif(count == 1)\n\t{\n\t\tOrderClear();\n\t} else {\n\t\tOrderTotalSum();\n\t\tlocalStorage.setItem('order-table', $('.order-table').html());\n\t}\n});\n\n// create new item (cashier -> admin)\n$('body').on('click', '#js-item--barcode-create', function(e){\n\te.preventDefault();\n\n\tvar barcode, data;\n\t\n\tbarcode = $('#js--item-search').val();\n\tdata  \t= {'barcode':barcode}\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + 'items/barcode',\n\t\ttype \t : 'post',\n\t\tdataType : 'json',\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t\tsuccess: function(answer) {\n\n\t\t\tif(answer.status == 0)\n\t\t\t{\n\t\t\t\tAnswerError(answer.message);\n\t\t\t}\n\n\t\t\tif(answer.status == 1)\n\t\t\t{\n\t\t\t\tAnswerSuccess(answer.message);\n\t\t\t}\n\n\t    },\n\n\t    error: function(answer) {\n\t    \tAnswerError();\n\t    }\n\n\t}).complete(function() {\n\t        LoaderStop();\n\t\t});\n});","/*\n\t------- SUPPLY FUNCTION ------- \n*/","/*\n\t------- COSTS FUNCTION ------- \n*/\n\n// create costs\n$('body').on('click', '#js-costs--create', function(e){\n\te.preventDefault();\n\n\tvar data = $('#js-costs--form').serialize();\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + segment2,\n\t\ttype \t : 'post',\n\t\tdataType : 'json',\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t    complete: function(answer, xhr, settings){\n\t    \tvalidationCreate(answer);\n\t    }\n\t});\n});","/*\n\t------- DISCOUNTS FUNCTION ------- \n*/\n\n// create\n$('body').on('click', '#js-discounts--create', function(e){\n\te.preventDefault();\n\n\tvar data = $('#js-discounts--form').serialize();\n\n\t$.ajax({\n\t\turl \t : base_url + '/' + segment1 + '/' + segment2,\n\t\ttype \t : 'post',\n\t\tdataType : 'json',\n\t\tdata \t : data,\n\n\t\tbeforeSend: function(){\n\t        LoaderStart();\n\t    },\n\n\t    complete: function(answer, xhr, settings){\n\t    \tvalidationCreate(answer);\n\t    }\n\t});\n});","/*\n\t------- SETTINGS FUNCTION ------- \n*/\n\n// csrf token add to post request\n$.ajaxSetup({\n\theaders: {\n\t  'X-CSRF-Token': $('meta[name=\"_token\"]').attr('content')\n\t}\n});\n\n});"],"sourceRoot":"/source/"}