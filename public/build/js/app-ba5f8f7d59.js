function getTypeColumn(e){var t;switch(e){case"name":t="string";break;case"price":case"items_price":case"sum":t="numeric";break;case"items_quantity":case"percent":t="integer";break;case"created_at":case"date":t="date";break;default:t="string"}return t}function getValueColumn(e,t){var a;switch(e){case"string":a=t.toString();break;case"numeric":a=number_format(t,0," "," ");break;case"integer":a=Number(t);break;case"date":a=t.toString()}return a}function removeDuplicates(e,t){var a=[],s={};for(var r in e)s[e[r][t]]=e[r];for(r in s)a.push(s[r]);return a}function functiontofindIndexByKeyValue(e,t,a){for(var s=0;s<e.length;s++)if(e[s][t]==a)return s;return"z"}function Answer(e,t){switch($("#alert").removeClass().html(""),e){case"success":$("#js-modal--create").modal("hide"),$("#alert").removeClass().addClass("alert alert-success").html(t);break;case"error":$("#js-modal--create").modal("hide"),$("#alert").removeClass().addClass("alert alert-danger").html("Ошибка запроса");break;case"info":$("#js-modal--create").modal("hide"),$("#js-modal--delete").modal("hide"),$("#alert").removeClass().addClass("alert alert-info").html(t);break;case"warning":$("#js-modal--create").modal("hide"),$("#alert").removeClass().addClass("alert alert-warning").html(t)}}function LoaderStart(){$("body").append('<div class="loader"></div>')}function LoaderStop(){$(".loader").remove()}function number_format(e,t,a,s){var r,n,l,o,d;return isNaN(t=Math.abs(t))&&(t=2),void 0==a&&(a=","),void 0==s&&(s="."),r=parseInt(e=(+e||0).toFixed(t))+"",(n=r.length)>3?n%=3:n=0,d=n?r.substr(0,n)+s:"",l=r.substr(n).replace(/(\d{3})(?=\d)/g,"$1"+s),o=t?a+Math.abs(e-r).toFixed(t).replace(/-/,0).slice(2):"",d+l+o}function graphParseData(e,t){var a,s,r={},n=[];switch(a=e[1]<0?Math.abs(e[1]):e[1],value=void 0==a?0:a,s=!(e[1]<0),t){case!0:return n.push(e[0]),n.push(value),n.push(s),n;case!1:return r.name=e[0],r.y=value,r.positive=s,r;default:return!1}}$(".modal").modal({backdrop:"static",keyboard:!1,show:!1}),$(document).ready(function(){function e(e){$.each(e,function(e,t){switch(t){case"update":$(".table tbody tr td[data-column]").each(function(){$(this).addClass("js--update")});break;case"delete":html='<td class="col-md-1"><button class="btn btn-danger btn-circle js--delete"><i class="fa fa-remove"></i></button></td>',$(".table tbody tr").each(function(){$(this).append(html)});break;case"status":$(".table tbody tr td button[data-status]").each(function(){$(this).addClass("js-items--status")})}})}function t(e){switch(html='<li class="dropdown">',html+='<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">',html+=userOptions.username+' <span class="caret"></span>',html+="</a>",html+='<ul class="dropdown-menu" role="menu">',parseInt(userOptions.status)){case 1:html+='<li><a href="'+base_url+"/"+segment1+'/items">Товары</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/orders">Заказы</a></li>';break;case 2:html+='<li><a href="'+base_url+"/"+segment1+'/items">Товары</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/orders">Заказы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/supply">Приходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/costs">Расходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/analytics">Аналитика</a></li>';break;case 3:html+='<li><a href="'+base_url+"/"+segment1+'/items">Товары</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/orders">Заказы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/supply">Приходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/costs">Расходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/discounts">Скидки</a></li>';break;case 4:html+='<li><a href="'+base_url+"/"+segment1+'/items">Товары</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/orders">Заказы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/supply">Приходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/costs">Расходы</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/analytics">Аналитика</a></li>',html+='<li><a href="'+base_url+"/"+segment1+'/discounts">Скидки</a></li>';break;default:return!1}if(html+='<li><a href="/logout"><i class="fa fa-btn fa-sign-out"></i>Выйти</a></li>',html+="</ul>",html+="</li>",$("ul.nav.navbar-nav.navbar-right").append(html),e){var t=[];checkOption=[],$("ul.nav.navbar-nav.navbar-right li.js--url-user-links").each(function(){var e=$(this).attr("id").substring(8);checkOption.push(e)}),checkOption.length>0?(Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})},t=e.diff(checkOption)):t=e,$.each(t,function(e,t){switch(t){case"create":$("ul.navbar-right").prepend('<li class="js--url-user-links" id="js--url-create"><a href="'+segment2+'/create">создать</a></li>');break;case"create-modal":$("ul.navbar-right").prepend('<li class="js--url-user-links" id="js--url-create-modal"><a href="#" data-toggle="modal" data-target="#js-modal--create">создать</a></li>');break;case"date-range":html='<li class="dropdown js--url-user-links" id="js--url-date-range">',html+='<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">',html+='настройки <span class="caret"></span>',html+="</a>",html+='<ul class="dropdown-menu dropdown-menu--lg" role="menu">',html+='<li class="dropdown-header">Выбрать период</li>',html+="<li>",html+='<div class="col-md-12">',html+='<form url="'+segment1+"/"+segment2+'/date" method="post" id="js-date_range--form">',html+='<div class="form-group col-md-push-1">',html+='<div class="input-group date datetimepicker">',html+='<input type="text" name="date_start" class="form-control input-sm" placeholder="Дата начала">',html+='<span class="input-group-addon">',html+='<span class="glyphicon glyphicon-calendar"></span>',html+="</span>",html+="</div>",html+="</div>",html+='<div class="form-group col-md-push-1">',html+='<div class="input-group date datetimepicker">',html+='<input type="text" name="date_end" class="form-control input-sm" placeholder="Дата конца">',html+='<span class="input-group-addon">',html+='<span class="glyphicon glyphicon-calendar"></span>',html+="</span>",html+="</div>",html+="</div>",html+='<button type="button" class="btn btn-primary btn-sm" id="js-date_range--sbm">Показать</button>',html+="</form>",html+="</div>",html+="</li>",html+='<li class="divider"></li>',html+="</ul>",html+="</li>",$("ul.navbar-right").prepend(html);break;case"graphics":html='<li class="dropdown" id="js--url-graphics">',html+='<a href="'+base_url+"/"+segment1+"/"+segment2+'/graphics">графики</a>',html+="</li>",$("ul.navbar-right").prepend(html);break;case"analyzes":html='<li class="dropdown" id="js--url-analyzes">',html+='<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">',html+='анализы <span class="caret"></span>',html+="</a>",html+='<ul class="dropdown-menu dropdown-menu--lg" role="menu">',html+='<li><a href="'+base_url+"/"+segment1+"/"+segment2+'/abc">ABC</a></li>',html+='<li><a href="'+base_url+"/"+segment1+"/"+segment2+'/xyz">XYZ</a></li>',html+="</ul>",html+="</li>",$("ul.navbar-right").prepend(html);break;default:return!1}})}}function a(){switch(parseInt(userOptions.status)){case 1:switch(segment2){case"orders":0==segment3.length?t(["date-range","create"]):t(),d();break;case"items":t();break;default:return!1}break;case 2:switch(segment2){case"items":t();break;case"analytics":t(["analyzes","graphics"]);break;case"orders":0==segment3.length&&t(["date-range"]);break;case"supply":0==segment3.length&&t(["date-range"]);break;case"costs":segment3.length>0?t(["date-range"]):t();break;default:return!1}break;case 3:switch(segment2){case"items":t(["create-modal"]),e(["update","status"]);break;case"orders":0==segment3.length?t(["date-range"]):t(),e(["delete"]);break;case"supply":0==segment3.length?(t(["date-range","create"]),e(["update"])):(t(),e(["update","delete"])),"create"==segment3&&d();break;case"costs":segment3.length>0?t(["date-range","create-modal"]):t(),e(["update","delete"]);break;case"discounts":t()}break;case 4:switch(segment2){case"items":t(["create-modal"]),e(["update","status"]);break;case"orders":0==segment3.length&&t(["date-range"]),e(["delete"]);break;case"supply":0==segment3.length&&t(["date-range","create"]),e(["update","delete"]);break;case"costs":segment3.length>0&&t(["date-range","create-modal"]),e(["update","delete"]);break;case"analytics":t(["analyzes","graphics"])}break;default:return!1}}function s(e){var t,a=0,s=0;$("strong").hasClass("totalSum")&&(e&&(t=$(".table tbody").find("[data-id='"+e.id+"']"),$(t).find("td.js--totalSum").html(number_format(e.sum,0," "," "))),$("td.js--totalSum").each(function(){a+=parseFloat($(this).text().replace(/\s/g,""))}),$(".totalSum").html("Итого "+number_format(a,0," "," ")+" &#8381;")),$("strong").hasClass("totalSumDiscount")&&($(".js--sum-discount").each(function(){s+=parseFloat($(this).text().replace(/\s/g,""))}),$(".totalSumDiscount").html("Итого со скидкой "+number_format(s,0," "," ")+" &#8381;"))}function r(e,t,a){var r=JSON.parse(e.responseText);switch(segment2){case"items":if(200==e.status)switch(t){case"create":r.data.price=number_format(r.data.price,0," "," "),html='<tr data-id="'+r.data.id+'">',html+="<td>"+r.data.barcode+"</td>",html+="<td>"+r.data.name+"</td>",html+='<td class="js--update" data-column="price">'+r.data.price+"</td>",html+='<td><button class="btn btn-circle btn-success js-items--status" data-status="'+r.data.status+'"><i class="fa fa-check"></i></button></td>',html+='<td><button type="button" data-barcode="'+r.data.barcode+'" class="btn btn-circle btn-primary js-items--print-review"><i class="fa fa-print"></i></button></td>',html+="</tr>",$(".table tbody").prepend(html),$(".table tbody tr").removeClass().first().addClass("success"),Answer("info",r.message),s();break;case"update":break;case"delete":break;case"status":var n=$(this);1===r.data?(n.removeClass("btn-danger").addClass("btn-success"),n.html('<i class="fa fa-check"></i>'),n.attr("data-status",e.status)):(n.removeClass("btn-success").addClass("btn-danger"),n.html('<i class="fa fa-ban"></i>'),n.attr("data-status",r.data));break;default:return!1}else if(422==e.status)switch(t){case"create":keys=Object.keys(r),$("form input").each(function(){input=$(this),keys.indexOf(input.attr("name"))!=-1?input.addClass("validate-error"):input.addClass("validate-success")});break;case"status":Answer("error")}break;case"supply":case"orders":if(200==e.status)switch(t){case"create":c(),Answer("success",'<a href="'+base_url+"/"+segment1+"/"+segment2+"/"+r.message+'">Оформлен заказ #'+r.message+"</a>");break;case"create--barcode":Answer("success",r.message);break;case"search":$(".order").removeClass("hidden"),v(r.data),$("#js-items--search").val("")}else if(422==e.status){switch(t){case"search":Answer("warning",'<button id="js-items--barcode-create" data-barcode="'+$("#js-items--search").val()+'" class="btn btn-danger">Отправить штрихкод</button>'),$("#js-items--search").val("")}Answer("error")}break;case"costs":if(200==e.status)switch(t){case"create":data=r.data,data.date=moment(r.data.created_at,"YYYY-MM-DD HH:mm:ss").format("DD/MM/YYYY"),data.sum=number_format(r.data.sum,0," "," "),html='<tr data-id="'+data.id+'">',html+='<td class="col-md-1">'+data.id+"</td>",html+='<td class="col-md-1">'+data.date+"</td>",html+='<td class="col-md-9 js--totalSum js--update" data-column="sum">'+data.sum+"</td>",html+='<td class="col-md-1"><button class="btn btn-circle btn-danger js--delete"><li class="fa fa-remove"></li></button></td>',html+="</tr>",$(".table tbody").prepend(html),$(".table tbody tr").removeClass().first().addClass("success"),Answer("info",r.message),s()}else 422==e.status&&Answer("error");break;case"discounts":if(200==e.status)switch(t){case"create":r.data.sum=number_format(r.data.sum,0," "," "),html='<tr data-id="'+r.data.id+'">',html+='<td class="col-md-1">'+r.data.id+"</td>",html+='<td class="col-md-5 js--update" data-column="sum">'+r.data.sum+"</td>",html+='<td class="col-md-5 js--update" data-column="percent">'+r.data.percent+"</td>",html+='<td class="col-md-1"><button class="btn btn-danger btn-circle js--delete"><i class="fa fa-remove"></i></button></td>',html+="</tr>",$(".table tbody").prepend(html),$(".table tbody tr").removeClass().first().addClass("success"),Answer("info",r.message),s();break;case"update":}}LoaderStop()}function n(e,t){var a=JSON.parse(e.responseText);switch(e.status){case 422:t.parent("td").html(t.attr("placeholder")),$(".table tbody tr").removeClass(),t.parents("tr").addClass("warning"),Answer("warning",a.message.value);break;case 200:var r=getTypeColumn(t.parent("td").data("column")),n=getValueColumn(r,t.val());t.removeAttr("id"),t.parent("td").html(n),$(".table tbody tr").removeClass(),t.parents("tr").addClass("info"),s(a.data),Answer("info",a.message)}LoaderStop()}function l(e,t){var a=JSON.parse(e.responseText);switch(e.status){case 422:Answer("error");break;case 301:window.location.href=base_url+"/"+segment1+"/"+segment2;break;case 200:Answer("info",a.message),t.remove(),s();break;case 404:break;default:Answer("error")}LoaderStop()}function o(e){var e,t,a,s,r,l;0==e.val()||0==e.val().length?e.parent("td").html(e.attr("placeholder")):(a=e.parents("tr"),t=a.data("id"),s=e.parent("td").data("column"),r=e.val(),type=a.parents("tbody").data("type"),l={column:s,value:r,type:type},$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/"+t,type:"patch",dataType:"json",data:l,beforeSend:function(){LoaderStart()},complete:function(t,a,s){n(t,e)}}))}function d(){null===localStorage.getItem("order-table")?($(".order").addClass("hidden"),$("#js-item--search").val("").focus()):(f(),g(),b(),$(".order-table").removeClass("hidden").html(localStorage.getItem("order-table")))}function c(){localStorage.clear(),$(".order-table table tbody").html(""),$(".js-order--type").removeClass("active"),d()}function m(e){var t,a;null==localStorage.getItem("items")?(t={},a=[],t.items=a,t.items.push(e),t.totalSum=e.price*e.quantity,t.discount=!1,localStorage.setItem("items",JSON.stringify(t))):(t=JSON.parse(localStorage.getItem("items")),t.items.push(e),localStorage.setItem("items",JSON.stringify(t))),b()}function u(e,t,a,s){var r,n,l;r=JSON.parse(localStorage.getItem("items")),max_qty=r.items[t].stock,qty=s<=max_qty?s:max_qty,n=a*qty,r.items[t].price=a,r.items[t].quantity=qty,r.items[t].sum=n,localStorage.setItem("items",JSON.stringify(r)),b(),l=$('*[data-item="'+t+'"]'),l.find(".js-order--sum").html(n),localStorage.setItem("order-table",$(".order-table").html()),e&&e.parent("td").hasClass("js-order--update-price")&&e.parent("td").html(a),e&&e.parent("td").hasClass("js-order--update-quantity")&&e.parent("td").html(qty)}function p(e){var t,a,s,r,n,l,o;t=e.parents("tr"),a=t.data("item"),s=t.find(".js-order--price").val(),r=t.find(".js-order--quantity").val(),n=$(".order-table tbody tr").length,l=JSON.parse(localStorage.getItem("items")),o=l.items.findIndex(function(e,t){return e.item===a}),l.items.splice(o,1),localStorage.setItem("items",JSON.stringify(l)),t.remove(),1==n?c():(b(),localStorage.setItem("order-table",$(".order-table").html()))}function h(e){var t,a,s,r,n,l;t=e.parents("tr"),a=t.data("item"),s=e.attr("placeholder"),r=Number(e.val()),0==r.length&&(s.length>0?e.val(s):e.val(1)),0==r&&e.val(1),e.parent("td").hasClass("js-order--update-price")&&(n=r,l=Number(t.find(".js-order--update-quantity").text())),e.parent("td").hasClass("js-order--update-quantity")&&(n=Number(t.find(".js-order--update-price").text()),l=r),u(e,a,n,l)}function b(){var e,t;e=JSON.parse(localStorage.getItem("items")),t=e.items.reduce(function(e,t){return e+t.sum},0),e.totalSum=t,localStorage.setItem("items",JSON.stringify(e)),$("#order-sum").html(t)}function f(){var e=$(".js-order--type").eq(localStorage["order-type-index"]),t=e.siblings();t.each(function(){$(this).removeClass("active")}),e.addClass("active")}function g(){var e=JSON.parse(localStorage.getItem("items")),t=$("#js-order--discount"),a=localStorage.getItem("orderDiscount");"true"===a?(e.discount=!0,t.addClass("active")):(e.discount=!1,t.removeClass("active")),localStorage.setItem("orderDiscount",e.discount),localStorage.setItem("items",JSON.stringify(e)),b()}function v(e){var t,a,s;a=$(".order-table tbody tr").length,t+='<tr data-item="'+a+'" data-id="'+e.id+'">',t+="<td>"+e.barcode+"</td>",t+="<td>"+e.name+"</td>",t+='<td class="js-order--update js-order--update-price">'+e.price+"</td>",t+='<td class="js-order--update js-order--update-quantity">1</td>',t+='<td class="js-order--sum">'+e.price+"</td>",t+='<td><button type="button" class="btn btn-xs btn-danger js-order--delete"><i class="fa fa-remove"></i></button></td>',t+="</tr>",s={id:e.id,item:a,barcode:e.barcode,price:Number(e.price),quantity:1,sum:Number(e.price),stock:Number(e.stock)},m(s),$(".order-table table tbody").append(t),localStorage.setItem("order-table",$(".order-table").html()),d()}function y(e){var t,a=JSON.parse(localStorage.getItem("items"));return null!==a?$.each(a.items,function(a,s){if(s.barcode===e){var r,n,l,o,d;return r=$('*[data-item="'+s.item+'"]'),n=r.find(".js-order--update-quantity"),l=Number(r.find(".js-order--update-price").html()),o=Number(n.html())+1,d=n.html(o),u(d,s.item,l,o),$("#js-items--search").val(""),t=!1,!1}t=!0}):t=!0,t}"undefined"!=typeof userOptions&&a(),$(".datetimepicker").datetimepicker({locale:"ru",format:"DD/MM/YYYY"}),$("body").on("focus",".datetimepickerCall",function(){var e=moment($(this).attr("placeholder"),"DD/MM/YYYY");$(this).datetimepicker({defaultDate:e,locale:"ru",format:"DD/MM/YYYY"})}),$("#js-date_range--sbm").click(function(e){e.preventDefault();var t,s,r;t=$("#js-date_range--form").serializeArray(),t.push({name:"id",value:segment3}),$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/date",type:"patch",dataType:"json",data:t,beforeSend:function(){$(".dropdown").removeClass("open"),LoaderStart()},success:function(e){if($(".col-body h2").remove(),0==e.status&&($(".table").addClass("hidden"),$(".col-footer").addClass("hidden"),$(".col-body").append("<h2>"+e.data+"</h2>")),1==e.status){switch(s="",r=JSON.stringify(e.data),t=JSON.parse(r),$(".table").removeClass("hidden"),$(".col-footer").removeClass("hidden"),segment2){case"costs":for(row in t)s+='<tr data-id="'+t[row].id+'">',s+='<td class="col-md-1">'+t[row].id+"</td>",s+='<td class="col-md-1">'+t[row].date+"</td>",s+='<td class="col-md-9 js--totalSum" data-column="sum">'+t[row].sum+"</td>",s+="</tr>";break;case"supply":for(row in t)s+='<tr data-id="'+t[row].id+'">',s+='<td class="col-md-1 js--url-link" data-url="'+segment2+"/"+t[row].id+'">'+t[row].id+"</td>",s+='<td class="col-md-1">'+t[row].date+"</td>",s+='<td class="col-md-9 js--totalSum data-column="sum">'+t[row].sum+"</td>",s+="</tr>";break;case"orders":for(row in t)s+='<tr data-id="'+t[row].id+'">',s+='<td class="col-md-1 js--url-link" data-url="'+segment2+"/"+t[row].id+'">'+t[row].id+"</td>",s+='<td class="col-md-1">'+t[row].date+"</td>",s+='<td class="col-md-4 js--totalSum">'+t[row].sum+"</td>",s+='<td class="col-md-4">'+t[row].sum_discount+"</td>",s+='<td class="col-md-2">'+t[row].type+"</td>",s+="</tr>";break;default:return!1}$(".table tbody").html(s),$(".totalSum").html("Итого: "+e.extra.totalSum+" &#8381;")}},error:function(e){Answer("error")}}).complete(function(){a(),LoaderStop()})}),$("body").on("click",".js--url-link",function(e){e.preventDefault();var t=$(this).data("url");window.location=t}),$("#js-modal--create").on("show.bs.modal",function(){$("input").first().focus()}),$("#js-modal--create").on("hidden.bs.modal",function(){$("input").val(""),$("input[name=points_id]").val(userOptions.points_id)}),$("body").on("click",".js--update",function(){var e,t,a;switch(e=$(this),t=e.text(),a=getTypeColumn(e.data("column"))){case"string":e.html('<input type="text" id="js--update" placeholder="'+t+'">'),e.find("input").focus();break;case"numeric":e.html('<input type="number" id="js--update" placeholder="'+t+'">'),e.find("input").focus();break;case"integer":e.html('<input type="number" id="js--update" placeholder="'+t+'">'),e.find("input").focus();break;case"date":e.html('<input type="text" id="js--update" class="datetimepickerCall" placeholder="'+t+'">'),e.find("input").focus();break;default:return!1}}),$("body").on("keypress","#js--update",function(e){13==e.which&&o($(this))}),$("body").on("focusout","#js--update",function(){o($(this))}),$("body").on("click",".js--delete",function(e){e.preventDefault(),$(this).attr("id","active"),$("#js-modal--delete").modal("show")}),$("body").on("click","#js--delete",function(e){e.preventDefault();var t,a;t=$("#active").parents("tr"),a=t.data("id"),$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/delete/"+a,type:"post",dataType:"json",data:{type:$("#active").parents("tbody").data("type")},beforeSend:function(){LoaderStart()},complete:function(e,a,s){l(e,t)}})}),$("#js-modal--delete").on("hidden.bs.modal",function(){$(".js--delete").removeAttr("id")}),$("body").on("click","#js-items--create",function(e){e.preventDefault();var t,a,s,n;t=$("#js-items--form").serialize(),a=$("#items_id").val(),0==a?(s=base_url+"/"+segment1+"/"+segment2,n="post"):(s=a,n="patch"),$.ajax({url:s,type:n,dataType:"json",data:t,beforeSend:function(){LoaderStart()},complete:function(e,t,a){r(e,"create")}})}),$("body").on("click",".js-items--status",function(e){e.preventDefault();var t,a,s,n;t=$(this),a=t.attr("data-status"),s=t.parents("tr").data("id"),n={id:s,status:a},$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/status",type:"patch",dataType:"json",data:n,beforeSend:function(){LoaderStart()},complete:function(e,t,a){r(e,"status")}})}),$("#js-item--barcode").focusout(function(){var e,t,a;e=$(this).val(),t={barcode:e},e&&$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/search",type:"patch",dataType:"json",data:t,beforeSend:function(){LoaderStart()},success:function(e){0==e.status&&($("#item_id, #name, #price, #quantity").val(""),$("#js-item--sbm").text("Создать"),AnswerInfo("<strong>"+e.message+"</strong>. Будет создан новый")),1==e.status&&(a=JSON.parse(JSON.stringify(e.items)),$("#item_id").val(a.id),$("#name").val(a.name),$("#price").val(a.price),$("#quantity").val(a.quantity),$("#js-item--sbm").text("Обновить"),AnswerWarning("<strong>"+e.message+"</strong>. Будет обновлен"))},error:function(e){AnswerError()}}).complete(function(){LoaderStop()})}),$("body").on("click",".js-items--print-review",function(e){e.preventDefault();var t=$(this).data("barcode");$("#print-modal strong").html(t),$("#js-items--print-review").val(t),$("#print-modal").modal("show")}),$("#print-modal").on("shown.bs.modal",function(){$("#print-quantity").numeric({decimal:!1,negative:!1}).focus()}),$("#print-quantity").keyup(function(){"0"==$(this).val()&&$(this).val(1)}),$("#js-items--print-cancel").click(function(e){$(".full").addClass("hidden"),$(".row").removeClass("hidden"),$("#print-modal").modal("hide")}),$("#js-items--print-review").click(function(e){$("#print-modal").modal("hide"),$(".row").addClass("hidden");var t,a,s,r,n,l;t="",a=$("#js-items--print-review").val(),s=$("#print-quantity").val(),r={barcode:a},$.ajax({url:base_url+"/"+segment1+"/"+segment2+"/barcode/generate",type:"patch",dataType:"json",data:r,beforeSend:function(){LoaderStart()},success:function(e){if(200==e.status){for(n=JSON.stringify(e.item),l=JSON.parse(n),i=0;i<s;i++)t+='<div class="box">',t+='<div class="header">ИП Зибарева С.С.</div>',t+='<div class="description"><span>'+l.barcode+"</span><time>"+e.time+"</time></div>",t+='<div class="title">'+l.name+"</div>",t+='<div class="barcode">'+e.barcode+"<br>",t+="<span>"+l.barcode+"</span></div>",t+='<div class="footer"><p>'+l.price+"</p>",t+="<span>руб. за шт.</span>",t+="</div></div>";$(".full").removeClass("hidden"),$(".print").html(t)}},error:function(e){AnswerError()}}).complete(function(){LoaderStop()})}),$("body").on("click","#js--items-print",function(e){e.preventDefault(),window.print()}),$("body").on("click","#js-orders-supply--create",function(e){e.preventDefault();var t,a,s,n,l,o,d;t=JSON.parse(localStorage.getItem("items")),a=t.totalSum,s=t.type,n=t.discount,l=t.counterparty,o=JSON.stringify(t.items),d={segment:segment2,totalSum:a,type:s,discount:n,counterparty:l,items:o},$.ajax({url:base_url+"/"+segment1+"/"+segment2,type:"post",dataType:"json",data:d,complete:function(e,t,a){r(e,"create")}})}),$("body").on("click",".js-order--type",function(e){var t,a,s;t=$(this),a=t.val(),localStorage&&(localStorage["order-type-index"]=t.index()),s=JSON.parse(localStorage.getItem("items")),s.type=a,localStorage.setItem("items",JSON.stringify(s)),f(t)}),$("body").on("click","#js-order--discount",function(e){var t=localStorage.getItem("orderDiscount"),a="true"===t?"false":"true";localStorage.setItem("orderDiscount",a),g()}),$("body").on("change",".js-supply--counterparty",function(e){var t,a;t=Number($("option:selected",this).val()),a=JSON.parse(localStorage.getItem("items")),a.counterparty=t,localStorage.setItem("items",JSON.stringify(a))}),$("#js-items--search").keyup(function(e){e.preventDefault();var t=$(this).val();13==t.length&&y(t)===!0&&$.ajax({url:base_url+"/"+segment1+"/items/search",type:"patch",dataType:"json",data:{barcode:t},complete:function(e,t,a){r(e,"search")}})}),$("body").on("click",".js-order--update",function(){var e,t;e=$(this),t=e.text(),e.html('<input type="number" id="js-order--update" placeholder="'+t+'">'),e.find("input").focus()}),$("body").on("keypress","#js-order--update",function(e){13==e.which&&h($(this))}),$("body").on("focusout","#js-order--update",function(){h($(this))}),$("body").on("click",".js-order--delete",function(){p($(this))}),$("body").on("click","#js-items--barcode-create",function(e){e.preventDefault();var t,a;t=$(this).data("barcode"),a={barcode:t},$.ajax({url:base_url+"/"+segment1+"/items/barcode",type:"post",dataType:"json",data:a,complete:function(e,t,a){r(e,"create--barcode")}})}),$("body").on("click","#js-costs--create",function(e){e.preventDefault();var t=$("#js-costs--form").serializeArray();t.push({name:"ccosts_id",value:segment3}),$.ajax({url:base_url+"/"+segment1+"/"+segment2,type:"post",dataType:"json",data:t,beforeSend:function(){LoaderStart()},complete:function(e,t,a){r(e,"create")}})}),$("body").on("click","#js-discounts--create",function(e){e.preventDefault();var t=$("#js-discounts--form").serialize();$.ajax({url:base_url+"/"+segment1+"/"+segment2,type:"post",dataType:"json",data:t,beforeSend:function(){LoaderStart()},complete:function(e,t,a){r(e,"create")}})}),$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="_token"]').attr("content")}})});